<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trace the Letter b</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Lexend', sans-serif;
      text-align: center;
      background-color: #f5f5f5;
    }
    canvas {
      border: 2px solid #ccc;
      background-color: white;
      touch-action: none;
    }
    .message {
      font-size: 1.5em;
      margin: 10px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
</head>
<body>
  <h1>Trace the Letter</h1>
  <p class="message" id="message">Trace the letter</p>
  <canvas id="traceCanvas" width="300" height="400"></canvas>

  <script>
    const canvas = document.getElementById("traceCanvas");
    const ctx = canvas.getContext("2d");
    const message = document.getElementById("message");
    const strokePaths = [
      // Stroke 1: vertical line
      [{x: 150, y: 50}, {x: 150, y: 250}],
      // Stroke 2: loop
      [
        {x: 150, y: 150},
        {x: 180, y: 150},
        {x: 180, y: 250},
        {x: 150, y: 250}
      ]
    ];

    let currentStroke = 0;
    let drawing = false;
    let points = [];

    // Draw base letter 'b' with stroke arrows
    function drawBase() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.lineWidth = 5;
      ctx.strokeStyle = "#ddd";

      // Draw vertical stroke
      ctx.beginPath();
      ctx.moveTo(150, 50);
      ctx.lineTo(150, 250);
      ctx.stroke();

      // Draw loop
      ctx.beginPath();
      ctx.moveTo(150, 150);
      ctx.bezierCurveTo(180, 150, 180, 250, 150, 250);
      ctx.stroke();

      // Draw arrow indicators
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.arc(150, 50, 6, 0, 2 * Math.PI); // start of stroke 1
      ctx.fill();
      ctx.beginPath();
      ctx.arc(150, 150, 6, 0, 2 * Math.PI); // start of stroke 2
      ctx.fill();
    }

    drawBase();

    canvas.addEventListener("pointerdown", (e) => {
      drawing = true;
      points = [{x: e.offsetX, y: e.offsetY}];
    });

    canvas.addEventListener("pointermove", (e) => {
      if (!drawing) return;
      const point = {x: e.offsetX, y: e.offsetY};
      points.push(point);
      ctx.lineWidth = 3;
      ctx.strokeStyle = "blue";
      ctx.beginPath();
      ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);
      ctx.lineTo(point.x, point.y);
      ctx.stroke();
    });

    canvas.addEventListener("pointerup", () => {
      drawing = false;
      if (validateStroke(points, strokePaths[currentStroke])) {
        currentStroke++;
        if (currentStroke === strokePaths.length) {
          message.textContent = "Good job!";
          speak("Good job!");
        } else {
          message.textContent = "Next stroke";
          speak("Next stroke");
        }
      } else {
        message.textContent = "Try again";
        speak("Try again");
      }
      setTimeout(drawBase, 800);
    });

    function validateStroke(userPoints, refPoints) {
      // Basic validation: check if user's points pass near reference line
      let pass = false;
      for (const p of userPoints) {
        for (const ref of refPoints) {
          const dx = p.x - ref.x;
          const dy = p.y - ref.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < 30) {
            pass = true;
            break;
          }
        }
        if (pass) break;
      }
      return pass;
    }

    function speak(text) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = "en-US";
      speechSynthesis.speak(msg);
    }

    // Start with a prompt
    speak("Trace the letter");
  </script>
</body>
</html>